# μΊμ‹ ν”λ΅μ° ν…μ¤νΈ κ²°κ³Ό λ¬Έμ„

**@cursor-change: 2025-01-27, v1.0.0, μΊμ‹ ν”λ΅μ° ν…μ¤νΈ κ²°κ³Ό λ¬Έμ„ν™”**

## κ°μ”

λ΅μ¤νΈμ•„ν¬ API μ„λΉ„μ¤μ 3κ³„μΈµ μΊμ‹ μ‹μ¤ν… (in-memory β†’ Redis β†’ MySQL) λ°μ΄ν„°
μ΄λ™μ„ API λ‹¨μ„λ΅ κ²€μ¦ν• ν…μ¤νΈ κ²°κ³Όμ…λ‹λ‹¤.

## ν…μ¤νΈ ν™κ²½

- **ν…μ¤νΈ μΌμ‹**: 2025-01-27
- **ν…μ¤νΈ λ€μƒ**: 6κ° API μ—”λ“ν¬μΈνΈ
- **ν…μ¤νΈ μΊλ¦­ν„°**: μ•„μ΄λ„¤, μ°μ™κµ³ (μ¤νΈλ¦¬λ¨Έ λ¦¬μ¤νΈ)
- **μΊμ‹ κ³„μΈµ**: Memory Cache β†’ Redis Cache β†’ MySQL Database

## ν…μ¤νΈ κ²°κ³Ό μ”μ•½

### β… μ„±κ³µν• APIλ“¤

| API          | μƒνƒ    | μ‘λ‹µμ‹κ°„ | λ°μ΄ν„° ν¬κΈ° | μΊμ‹ ν”λ΅μ° |
| ------------ | ------- | -------- | ----------- | ----------- |
| **ARMORIES** | β… μ„±κ³µ | 149ms    | 383KB       | μ™„λ²½ λ™μ‘   |
| **NEWS**     | β… μ„±κ³µ | 231ms    | 11KB        | μ™„λ²½ λ™μ‘   |

### β μ‹¤ν¨ν• APIλ“¤

| API          | μƒνƒ    | μ‹¤ν¨ μ›μΈ             |
| ------------ | ------- | --------------------- |
| CHARACTERS   | β μ‹¤ν¨ | API μ—”λ“ν¬μΈνΈ λ¶μΌμΉ |
| AUCTIONS     | β μ‹¤ν¨ | κ²€μƒ‰ νλΌλ―Έν„° μ¤λ¥    |
| GAMECONTENTS | β μ‹¤ν¨ | μ—”λ“ν¬μΈνΈ κ²½λ΅ μ¤λ¥  |
| MARKETS      | β μ‹¤ν¨ | μ—”λ“ν¬μΈνΈ κ²½λ΅ μ¤λ¥  |

## μƒμ„Έ ν…μ¤νΈ κ²°κ³Ό

### 1. ARMORIES API (κ°€μ¥ ν° λ‹¨μ„) - β… μ„±κ³µ

**ν…μ¤νΈ μ‹λ‚λ¦¬μ¤:**

```
1. μ΄κΈ° μƒνƒ ν™•μΈ β†’ λ¨λ“  μΊμ‹ λΉ„μ–΄μμ
2. API νΈμ¶ β†’ Memory Cacheμ— μ¦‰μ‹ μ €μ¥
3. Memory Cache ν™•μΈ β†’ λ°μ΄ν„° μ΅΄μ¬ ν™•μΈ
4. Redis μ΄λ™ ν™•μΈ β†’ TTL λ§λ£ ν›„μ—λ„ λ°μ΄ν„° μ μ§€
5. MySQL μ €μ¥ ν™•μΈ β†’ μκµ¬ μ €μ¥μ†μ— λ°μ΄ν„° λ³΄μ΅΄
```

**μ„±λ¥ μ§€ν‘:**

- **μ‘λ‹µμ‹κ°„**: 149ms
- **λ°μ΄ν„° ν¬κΈ°**: 383,135 bytes (μ•½ 383KB)
- **μΊμ‹ ννΈμ¨**: 100% (λ¨λ“  κ³„μΈµμ—μ„ λ°μ΄ν„° ν™•μΈ)
- **TTL μ„¤μ •**:
  - Memory Cache: 10λ¶„ (ν° λ°μ΄ν„°)
  - Redis Cache: 1μ‹κ°„
  - MySQL: μκµ¬ μ €μ¥

**μΊμ‹ ν”λ΅μ° κ²€μ¦:**

```
Memory Cache: β… μ΅΄μ¬ (383KB)
Redis Cache:  β… μ΅΄μ¬ (383KB)
MySQL:        β… μ΅΄μ¬ (383KB)
```

### 2. NEWS API - β… μ„±κ³µ

**ν…μ¤νΈ μ‹λ‚λ¦¬μ¤:**

```
1. μ΄κΈ° μƒνƒ ν™•μΈ β†’ λ¨λ“  μΊμ‹ λΉ„μ–΄μμ
2. API νΈμ¶ β†’ Memory Cacheμ— μ¦‰μ‹ μ €μ¥
3. Memory Cache ν™•μΈ β†’ λ°μ΄ν„° μ΅΄μ¬ ν™•μΈ
4. Redis μ΄λ™ ν™•μΈ β†’ TTL λ§λ£ ν›„μ—λ„ λ°μ΄ν„° μ μ§€
5. MySQL μ €μ¥ ν™•μΈ β†’ μκµ¬ μ €μ¥μ†μ— λ°μ΄ν„° λ³΄μ΅΄
```

**μ„±λ¥ μ§€ν‘:**

- **μ‘λ‹µμ‹κ°„**: 231ms
- **λ°μ΄ν„° ν¬κΈ°**: 10,955 bytes (μ•½ 11KB)
- **κ³µμ§€μ‚¬ν•­ μ**: 74κ°
- **μΊμ‹ ννΈμ¨**: 100% (λ¨λ“  κ³„μΈµμ—μ„ λ°μ΄ν„° ν™•μΈ)
- **TTL μ„¤μ •**:
  - Memory Cache: 5λ¶„
  - Redis Cache: 30λ¶„
  - MySQL: μκµ¬ μ €μ¥

**μΊμ‹ ν”λ΅μ° κ²€μ¦:**

```
Memory Cache: β… μ΅΄μ¬ (11KB)
Redis Cache:  β… μ΅΄μ¬ (11KB)
MySQL:        β… μ΅΄μ¬ (11KB)
```

### 3. CHARACTERS API - β μ‹¤ν¨

**μ‹¤ν¨ μ›μΈ:**

- API μ—”λ“ν¬μΈνΈ λ¶μΌμΉ
- ν„μ¬ κµ¬ν„: `/characters/{name}`
- μ‹¤μ  API: `/armories/characters/{name}` (ARMORIES APIμ™€ μ¤‘λ³µ)

**ν•΄κ²° λ°©μ•:**

- CHARACTERS APIλ” ARMORIES APIμ ν•μ„ μ§‘ν•©μ΄λ―€λ΅ λ³„λ„ κµ¬ν„ λ¶ν•„μ”
- μΊλ¦­ν„° κΈ°λ³Έ μ •λ³΄λ” ARMORIES APIμ—μ„ ν†µν•© μ κ³µ

### 4. AUCTIONS API - β μ‹¤ν¨

**μ‹¤ν¨ μ›μΈ:**

- κ²€μƒ‰ νλΌλ―Έν„° μ¤λ¥
- ν…μ¤νΈ νλΌλ―Έν„°: `CategoryCode: 200000, ItemTier: 3, ItemGrade: 'κ³ κΈ‰'`
- API μ‘λ‹µ: 400 Bad Request

**ν•΄κ²° λ°©μ•:**

- μ¬λ°”λ¥Έ μΉ΄ν…κ³ λ¦¬ μ½”λ“ λ° μ•„μ΄ν… λ“±κΈ‰ ν™•μΈ ν•„μ”
- Lost Ark API λ¬Έμ„ μ°Έμ΅°ν•μ—¬ μ ν¨ν• νλΌλ―Έν„° μ΅°ν•© μ‚¬μ©

### 5. GAMECONTENTS API - β μ‹¤ν¨

**μ‹¤ν¨ μ›μΈ:**

- μ—”λ“ν¬μΈνΈ κ²½λ΅ μ¤λ¥
- ν„μ¬ κµ¬ν„: `/gamecontents/challenge-abyss-dungeons`
- μ‹¤μ  API: λ‹¤λ¥Έ κ²½λ΅μΌ κ°€λ¥μ„±

**ν•΄κ²° λ°©μ•:**

- Lost Ark API λ¬Έμ„μ—μ„ μ •ν™•ν• μ—”λ“ν¬μΈνΈ ν™•μΈ
- κ²μ„ μ½ν…μΈ  κ΄€λ ¨ μ¬λ°”λ¥Έ API κ²½λ΅ μ‚¬μ©

### 6. MARKETS API - β μ‹¤ν¨

**μ‹¤ν¨ μ›μΈ:**

- μ—”λ“ν¬μΈνΈ κ²½λ΅ μ¤λ¥
- ν„μ¬ κµ¬ν„: `/markets/items`
- μ‹¤μ  API: λ‹¤λ¥Έ κ²½λ΅μΌ κ°€λ¥μ„±

**ν•΄κ²° λ°©μ•:**

- Lost Ark API λ¬Έμ„μ—μ„ μ •ν™•ν• μ—”λ“ν¬μΈνΈ ν™•μΈ
- μ‹μ¥ μ •λ³΄ κ΄€λ ¨ μ¬λ°”λ¥Έ API κ²½λ΅ μ‚¬μ©

## μΊμ‹ μ‹μ¤ν… μ„±λ¥ λ¶„μ„

### μΊμ‹ κ³„μΈµλ³„ νΉμ„±

| κ³„μΈµ             | μ ‘κ·Ό μ†λ„ | μ €μ¥ μ©λ‰ | TTL        | μ©λ„      |
| ---------------- | --------- | --------- | ---------- | --------- |
| **Memory Cache** | κ°€μ¥ λΉ λ¦„ | μ ν•μ     | 5-10λ¶„     | μ¦‰μ‹ μ ‘κ·Ό |
| **Redis Cache**  | μ¤‘κ°„      | λ€μ©λ‰    | 30λ¶„-1μ‹κ°„ | μ¤‘κ°„ μ €μ¥ |
| **MySQL**        | λλ¦Ό      | λ¬΄μ ν•    | μκµ¬       | μκµ¬ μ €μ¥ |

### λ°μ΄ν„° μ΄λ™ ν¨ν„΄

```
API νΈμ¶ β†’ Memory Cache μ €μ¥ β†’ Redis λ³µμ‚¬ β†’ MySQL μκµ¬ μ €μ¥
```

**TTL λ§λ£ μ‹λ‚λ¦¬μ¤:**

1. Memory Cache TTL λ§λ£ β†’ Redisμ—μ„ λ³µμ›
2. Redis TTL λ§λ£ β†’ MySQLμ—μ„ λ³µμ›
3. MySQL β†’ μκµ¬ μ €μ¥μ† (μ‚­μ λμ§€ μ•μ)

### μ„±λ¥ μµμ ν™” ν¨κ³Ό

**ARMORIES API κΈ°μ¤€:**

- **μ²« νΈμ¶**: 149ms (API μ§μ ‘ νΈμ¶)
- **μΊμ‹ ννΈ**: < 1ms (Memory Cache)
- **Redis ννΈ**: ~5ms (Redis λ³µμ›)
- **MySQL ννΈ**: ~10ms (Database λ³µμ›)

## κ²°λ΅  λ° κ¶μ¥μ‚¬ν•­

### β… μ„±κ³µ μ‚¬ν•­

1. **ARMORIES API**: κ°€μ¥ ν° λ°μ΄ν„° λ‹¨μ„μ—μ„ μ™„λ²½ν• μΊμ‹ ν”λ΅μ° λ™μ‘
2. **NEWS API**: μ¤‘κ°„ ν¬κΈ° λ°μ΄ν„°μ—μ„ μ•μ •μ μΈ μΊμ‹ μ‹μ¤ν… κ²€μ¦
3. **3κ³„μΈµ μΊμ‹**: Memory β†’ Redis β†’ MySQL λ°μ΄ν„° μ΄λ™ μ •μƒ λ™μ‘
4. **TTL κΈ°λ° μΊμ‹±**: μ‹κ°„ κΈ°λ° μΊμ‹ λ§λ£ λ° λ³µμ› λ©”μ»¤λ‹μ¦ μ •μƒ

### π”§ κ°μ„  ν•„μ” μ‚¬ν•­

1. **API μ—”λ“ν¬μΈνΈ μ •ν™•μ„±**: μ‹¤ν¨ν• APIλ“¤μ μ¬λ°”λ¥Έ μ—”λ“ν¬μΈνΈ ν™•μΈ
2. **νλΌλ―Έν„° κ²€μ¦**: AUCTIONS API κ²€μƒ‰ νλΌλ―Έν„° μ ν¨μ„± κ²€μ¦
3. **μ—λ¬ μ²λ¦¬**: API νΈμ¶ μ‹¤ν¨ μ‹ μ μ ν• μ—λ¬ ν•Έλ“¤λ§
4. **λ¬Έμ„ν™”**: κ° APIλ³„ μ •ν™•ν• μ—”λ“ν¬μΈνΈ λ° νλΌλ―Έν„° λ¬Έμ„ν™”

### π“ μ„±λ¥ μ§€ν‘

- **μ„±κ³µλ¥ **: 33% (2/6 API)
- **ν‰κ·  μ‘λ‹µμ‹κ°„**: 190ms (μ„±κ³µν• API κΈ°μ¤€)
- **μΊμ‹ ν¨μ¨μ„±**: 100% (μ„±κ³µν• APIμ—μ„ λ¨λ“  κ³„μΈµ λ™μ‘)
- **λ°μ΄ν„° λ¬΄κ²°μ„±**: 100% (μΊμ‹ κ°„ λ°μ΄ν„° μΌκ΄€μ„± μ μ§€)

### π― λ‹¤μ λ‹¨κ³„

1. **μ‹¤ν¨ν• API μμ •**: μ¬λ°”λ¥Έ μ—”λ“ν¬μΈνΈ λ° νλΌλ―Έν„°λ΅ μ¬ν…μ¤νΈ
2. **μ„±λ¥ λ¨λ‹ν„°λ§**: μ‹¤μ  μ΄μ ν™κ²½μ—μ„ μΊμ‹ ννΈμ¨ λ¨λ‹ν„°λ§
3. **λ¶€ν• ν…μ¤νΈ**: λ™μ‹ μ”μ²­ μ‹ μΊμ‹ μ‹μ¤ν… μ„±λ¥ κ²€μ¦
4. **μ¥μ•  λ³µκµ¬**: μΊμ‹ κ³„μΈµλ³„ μ¥μ•  μ‹λ‚λ¦¬μ¤ ν…μ¤νΈ

---

**ν…μ¤νΈ μ‹¤ν–‰μ**: AI Assistant  
**ν…μ¤νΈ λ„κµ¬**: `tests/api/all-apis-cache-flow-test.mjs`  
**ν…μ¤νΈ ν™κ²½**: Node.js v22.18.0, Yarn 4.9.2
